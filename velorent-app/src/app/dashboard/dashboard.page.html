<ion-header>
  <ion-toolbar>
    <ion-title>VeloRent</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content id="main-content">
  <!-- Enhanced Search Bar with Integrated Filters -->
  <div class="search-filter-container">
    <div class="search-bar-modern">
      <div class="search-section">
        <ion-searchbar
          placeholder="Search vehicles..."
          animated
          class="search-input"
          (ionInput)="searchVehicles($event)">
        </ion-searchbar>
        <button class="filter-toggle-btn" (click)="toggleFilters()" #filterBtn>
          <ion-icon name="options-outline"></ion-icon>
          <span *ngIf="selectedCategory !== 'all'" class="filter-badge">{{ getCategoryLabel(selectedCategory) }}</span>
        </button>
      </div>
      
      <!-- Compact Filter Modal -->
      <div class="filter-modal-overlay" [class.active]="showFilters" (click)="toggleFilters()"></div>
      <div class="filter-modal" [class.active]="showFilters" #filterModal>
        <div class="filter-modal-header">
          <span class="filter-title">Vehicle Type</span>
          <button class="close-filters" (click)="toggleFilters()">
            <ion-icon name="close-outline"></ion-icon>
          </button>
        </div>
        <div class="filter-options">
          <button 
            class="filter-option" 
            [class.active]="selectedCategory === 'all'"
            (click)="selectCategory('all'); toggleFilters()">
            <span>All Vehicles</span>
            <ion-icon name="checkmark" *ngIf="selectedCategory === 'all'" class="check-icon"></ion-icon>
          </button>
          <button 
            class="filter-option" 
            [class.active]="selectedCategory === 'sedan'"
            (click)="selectCategory('sedan'); toggleFilters()">
            <span>Sedan</span>
            <ion-icon name="checkmark" *ngIf="selectedCategory === 'sedan'" class="check-icon"></ion-icon>
          </button>
          <button 
            class="filter-option" 
            [class.active]="selectedCategory === 'suv'"
            (click)="selectCategory('suv'); toggleFilters()">
            <span>SUV</span>
            <ion-icon name="checkmark" *ngIf="selectedCategory === 'suv'" class="check-icon"></ion-icon>
          </button>
          <button 
            class="filter-option" 
            [class.active]="selectedCategory === 'hatchback'"
            (click)="selectCategory('hatchback'); toggleFilters()">
            <span>Hatchback</span>
            <ion-icon name="checkmark" *ngIf="selectedCategory === 'hatchback'" class="check-icon"></ion-icon>
          </button>
          <button 
            class="filter-option" 
            [class.active]="selectedCategory === 'coupe'"
            (click)="selectCategory('coupe'); toggleFilters()">
            <span>Coupe</span>
            <ion-icon name="checkmark" *ngIf="selectedCategory === 'coupe'" class="check-icon"></ion-icon>
          </button>
          <button 
            class="filter-option" 
            [class.active]="selectedCategory === 'convertible'"
            (click)="selectCategory('convertible'); toggleFilters()">
            <span>Convertible</span>
            <ion-icon name="checkmark" *ngIf="selectedCategory === 'convertible'" class="check-icon"></ion-icon>
          </button>
          <button 
            class="filter-option" 
            [class.active]="selectedCategory === 'truck'"
            (click)="selectCategory('truck'); toggleFilters()">
            <span>Truck</span>
            <ion-icon name="checkmark" *ngIf="selectedCategory === 'truck'" class="check-icon"></ion-icon>
          </button>
          <button 
            class="filter-option" 
            [class.active]="selectedCategory === 'van'"
            (click)="selectCategory('van'); toggleFilters()">
            <span>Van</span>
            <ion-icon name="checkmark" *ngIf="selectedCategory === 'van'" class="check-icon"></ion-icon>
          </button>
          <button 
            class="filter-option" 
            [class.active]="selectedCategory === 'motorcycle'"
            (click)="selectCategory('motorcycle'); toggleFilters()">
            <span>Motorcycle</span>
            <ion-icon name="checkmark" *ngIf="selectedCategory === 'motorcycle'" class="check-icon"></ion-icon>
          </button>
          <button 
            class="filter-option" 
            [class.active]="selectedCategory === 'bus'"
            (click)="selectCategory('bus'); toggleFilters()">
            <span>Bus</span>
            <ion-icon name="checkmark" *ngIf="selectedCategory === 'bus'" class="check-icon"></ion-icon>
          </button>
          <button 
            class="filter-option" 
            [class.active]="selectedCategory === 'other'"
            (click)="selectCategory('other'); toggleFilters()">
            <span>Other</span>
            <ion-icon name="checkmark" *ngIf="selectedCategory === 'other'" class="check-icon"></ion-icon>
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Vehicles Grid -->
  <ion-grid class="vehicles-grid">
    <ion-row>
      <ion-col size="6" size-md="4" size-lg="3" *ngFor="let vehicle of displayedVehicles">
        <ion-card class="vehicle-card" [class.unavailable]="!isVehicleAvailable(vehicle)" (click)="viewVehicleDetails(vehicle.id)">
          <div class="image-container">
            <img [src]="vehicle.imageUrl || 'assets/images/vehicle-placeholder.svg'" 
                 [alt]="vehicle.name"
                 (error)="vehicle.imageUrl = 'assets/images/vehicle-placeholder.svg'"/>
            <ion-badge *ngIf="vehicle.status" [color]="getStatusColor(vehicle.status)" class="status-badge">
              {{ getStatusLabel(vehicle.status) }}
            </ion-badge>
          </div>
          <ion-card-header>
            <ion-card-subtitle>{{ vehicle.type }}</ion-card-subtitle>
            <ion-card-title>{{ vehicle.name }}</ion-card-title>
            <div class="vehicle-company" *ngIf="vehicle.company_id">
              <small style="color: #ffd700; font-weight: 500;">
                {{ getCompanyName(vehicle.company_id) }}
              </small>
            </div>
          </ion-card-header>
          <ion-card-content>
            <div class="price-container">
              <span class="price">â‚±{{ vehicle.price_without_driver | number:'1.2-2' }}</span>
              <span class="per-day">/day without driver</span>
            </div>
            <ion-button 
              expand="block" 
              [color]="isVehicleAvailable(vehicle) ? 'primary' : 'medium'" 
              class="rent-button"
              [disabled]="!isVehicleAvailable(vehicle)">
              {{ isVehicleAvailable(vehicle) ? 'Rent Now' : getStatusLabel(vehicle.status) }}
            </ion-button>
          </ion-card-content>
        </ion-card>
      </ion-col>
    </ion-row>
  </ion-grid>

  <div class="browse-all-container" *ngIf="!showAllVehicles && filteredVehicles.length > INITIAL_VEHICLE_COUNT">
    <ion-button expand="block" color="secondary" class="browse-all-btn" (click)="onBrowseAllVehicles()">
      <ion-icon name="grid-outline" slot="start"></ion-icon>
      Browse All Vehicles
    </ion-button>
  </div>
  <div class="browse-all-container" *ngIf="showAllVehicles && filteredVehicles.length > INITIAL_VEHICLE_COUNT">
    <ion-button expand="block" color="medium" class="minimize-btn" (click)="onMinimizeVehicles()">
      <ion-icon name="chevron-up-outline" slot="start"></ion-icon>
      Show Less
    </ion-button>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Loading vehicles...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="error && !loading" class="error-container">
    <ion-icon name="alert-circle-outline"></ion-icon>
    <p>{{ error }}</p>
    <ion-button (click)="loadVehicles()">Try Again</ion-button>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && !error && vehicles.length === 0" class="empty-container">
    <ion-icon name="car-outline" style="font-size: 64px; color: #999;"></ion-icon>
    <h2>No Vehicles Available</h2>
    <p>There are no vehicles available at the moment. Please check back later.</p>
  </div>

  <!-- Featured Rental Companies -->
  <section class="featured-companies">
    <h2>Featured Rental Companies</h2>
    <div class="companies-carousel">
      <ion-slides [options]="companiesSwiperConfig" class="companies-swiper">
        <ion-slide *ngFor="let company of companies">
          <div class="company-item" (click)="viewCompanyDetails(company.id)">
            <div class="company-card">
              <div class="company-logo">
                <img [src]="company.logoUrl" [alt]="company.name" (error)="company.logoUrl = 'assets/images/company-placeholder.svg'">
              </div>
            </div>
            <div class="company-info">
              <h3>{{ company.name }}</h3>
            </div>
          </div>
        </ion-slide>
      </ion-slides>
    </div>
  </section>

  <ion-card class="featured-companies" *ngIf="companies.length === 0">
    <ion-card-header>
      <ion-card-title>Featured Rental Companies</ion-card-title>
    </ion-card-header>
    <ion-card-content>
      <div class="no-companies">
        <ion-icon name="business-outline"></ion-icon>
        <p>No rental companies available yet</p>
      </div>
    </ion-card-content>
  </ion-card>
</ion-content>

<!-- Modern Bottom Navigation -->
<div class="bottom-nav">
  <div class="nav-container">
    <button class="nav-button active" (click)="navigateToHome()">
      <ion-icon name="home" class="nav-icon"></ion-icon>
      <span class="nav-label">Home</span>
    </button>
    
    <button class="nav-button" (click)="navigateToMyRentals()">
      <ion-icon name="car-outline" class="nav-icon"></ion-icon>
      <span class="nav-label">My Rentals</span>
    </button>
    
    <button class="nav-button" (click)="navigateToRequests()">
      <div class="notification-wrapper">
        <ion-icon name="document-text-outline" class="nav-icon"></ion-icon>
        <div *ngIf="requestUnreadCount > 0" class="notification-badge">
          {{ requestUnreadCount }}
        </div>
      </div>
      <span class="nav-label">Requests{{ requestUnreadCount > 0 ? ' (' + requestUnreadCount + ')' : '' }}</span>
    </button>
    
    <button class="nav-button" (click)="navigateToNotifications()">
      <div class="notification-wrapper">
      <ion-icon name="notifications-outline" class="nav-icon"></ion-icon>
        <div *ngIf="unreadCount > 0" class="notification-badge">
          {{ unreadCount }}
        </div>
      </div>
      <span class="nav-label">Notifications{{ unreadCount > 0 ? ' (' + unreadCount + ')' : '' }}</span>
    </button>
    
    <button class="nav-button" (click)="navigateToProfile()">
      <ion-icon name="person-outline" class="nav-icon"></ion-icon>
      <span class="nav-label">Profile</span>
    </button>
  </div>
</div>
