import{a as n}from"./chunk-NUHOWZQU.js";import{aa as g,ba as u,c as h,f as t,g as p,h as c,i as d}from"./chunk-2AVOPVJ6.js";var v=(()=>{let a=class a{constructor(e){this.http=e,this.handleError=r=>{console.error("API Error:",r);let i="An error occurred",l=this.apiUrl||"https://velorent-backend.onrender.com/api";if(r.error instanceof ErrorEvent)i=r.error.message;else if(r.status===0)i=`Network Error: Unable to connect to server. Please check:
1. Backend server is running on ${l}
2. Device and server are on the same network
3. Firewall allows connections on port 3000
4. Backend server is accessible at ${l}`;else{let s=r.error;s!=null&&s.message?i=s.message:s!=null&&s.error?i=s.error:s!=null&&s.details&&Array.isArray(s.details)&&s.details.length>0?i=s.details[0]:i=`Error Code: ${r.status}
Message: ${r.message||"Unknown error"}`}return h(()=>new Error(i))},n&&n.apiUrl?this.apiUrl=n.apiUrl:window.__ENV__&&window.__ENV__.apiUrl?this.apiUrl=window.__ENV__.apiUrl:this.apiUrl="https://velorent-backend.onrender.com/api",console.log("ApiService initialized"),console.log("Environment object:",n),console.log("Environment type:",typeof n),console.log("API URL:",this.apiUrl)}getHeaders(){let e=localStorage.getItem("token");return new g().set("Authorization",`Bearer ${e}`)}login(e,r){return this.http.post(`${this.apiUrl}/auth/login`,{email:e,password:r})}register(e,r,i){return this.http.post(`${this.apiUrl}/auth/register`,{name:e,email:r,password:i})}getVehicles(){return console.log("Fetching vehicles from API..."),this.http.get(`${this.apiUrl}/vehicles`).pipe(p(e=>console.log("Vehicles API response:",e)),t(this.handleError))}getVehicle(e){return this.http.get(`${this.apiUrl}/vehicles/${e}`).pipe(t(this.handleError))}getCompanies(){return this.http.get(`${this.apiUrl}/companies`).pipe(t(this.handleError))}getCompany(e){return this.http.get(`${this.apiUrl}/companies/${e}`).pipe(t(this.handleError))}getCompanyRules(e){return this.http.get(`${this.apiUrl}/companies/${e}/rules`).pipe(t(this.handleError))}getMyRentals(){return this.http.get(`${this.apiUrl}/rentals/my-rentals`,{headers:this.getHeaders()}).pipe(t(this.handleError))}getRental(e){return this.http.get(`${this.apiUrl}/rentals/${e}`,{headers:this.getHeaders()}).pipe(t(this.handleError))}createRental(e){return this.http.post(`${this.apiUrl}/rentals`,e,{headers:this.getHeaders()}).pipe(t(this.handleError))}cancelRental(e){return this.http.post(`${this.apiUrl}/rentals/${e}/cancel`,{},{headers:this.getHeaders()}).pipe(t(this.handleError))}deleteBooking(e){return this.http.delete(`${this.apiUrl}/rentals/bookings/${e}`,{headers:this.getHeaders()}).pipe(t(this.handleError))}deleteMultipleBookings(e){return this.http.post(`${this.apiUrl}/rentals/bookings/delete-multiple`,{bookingIds:e},{headers:this.getHeaders()}).pipe(t(this.handleError))}getAvailableVehicles(){return this.http.get(`${this.apiUrl}/vehicles`).pipe(t(this.handleError))}getUserRentals(e){return this.http.get(`${this.apiUrl}/rentals/user/${e}`).pipe(t(this.handleError))}createRentalWithFiles(e){let r=localStorage.getItem("token");return console.log("=== CREATE RENTAL DEBUG ==="),console.log("Token exists:",!!r),console.log("Token value (first 20 chars):",r?r.substring(0,20)+"...":"No token"),console.log("API URL:",`${this.apiUrl}/rentals`),r?this.http.post(`${this.apiUrl}/rentals`,e).pipe(t(i=>(console.error("Error in createRentalWithFiles:",i),i.status===401&&(console.error("401 Unauthorized - Token might be expired or invalid"),console.error("Please log in again to get a fresh token")),this.handleError(i)))):(console.error("No token found in localStorage - user needs to log in"),h(()=>new Error("Authentication required. Please log in again.")))}createBooking(e){return this.http.post(`${this.apiUrl}/rentals/bookings`,e).pipe(t(this.handleError))}verifyId(e){let r=new FormData;return r.append("idImage",e),this.http.post(`${this.apiUrl}/verify-id`,r).pipe(t(this.handleError))}getMyBookings(){let e=this.getHeaders();return console.log("=== API SERVICE DEBUG ==="),console.log("API URL:",`${this.apiUrl}/rentals/my-bookings`),console.log("Headers:",e),console.log("Token from localStorage:",localStorage.getItem("token")),this.http.get(`${this.apiUrl}/rentals/my-bookings`,{headers:e}).pipe(t(this.handleError))}markNotificationAsRead(e){let r=this.getHeaders();return this.http.put(`${this.apiUrl}/rentals/${e}/mark-notification-read`,{},{headers:r}).pipe(t(this.handleError))}getCompanyAvailability(e){return this.http.get(`${this.apiUrl}/companies/${e}/availability`).pipe(t(this.handleError))}checkCompanyAvailability(e,r,i){return this.http.post(`${this.apiUrl}/companies/${e}/check-availability`,{date:r,time:i}).pipe(t(this.handleError))}getDrivers(e){return this.http.get(`${this.apiUrl}/companies/${e}/drivers`).pipe(t(this.handleError))}checkVehicleAvailability(e,r,i){return this.http.get(`${this.apiUrl}/vehicles/${e}/availability?startDate=${r}&endDate=${i}`).pipe(t(this.handleError))}getMyNotifications(){return this.http.get(`${this.apiUrl}/notifications/my-notifications`,{headers:this.getHeaders()}).pipe(t(this.handleError))}getUnreadNotificationCount(){return this.http.get(`${this.apiUrl}/notifications/unread-count`,{headers:this.getHeaders()}).pipe(t(this.handleError))}markNotificationAsReadById(e){return this.http.put(`${this.apiUrl}/notifications/${e}/read`,{},{headers:this.getHeaders()}).pipe(t(this.handleError))}markAllNotificationsAsRead(){return this.http.put(`${this.apiUrl}/notifications/mark-all-read`,{},{headers:this.getHeaders()}).pipe(t(this.handleError))}createPayment(e,r){return this.http.post(`${this.apiUrl}/payments/create-payment`,{amount:e,booking_id:r},{headers:this.getHeaders()}).pipe(t(this.handleError))}getPaymentStatus(e){return this.http.get(`${this.apiUrl}/payments/status/${e}`,{headers:this.getHeaders()}).pipe(t(this.handleError))}getTransactionDetails(e){return this.http.get(`${this.apiUrl}/rentals/transaction/${e}`,{headers:this.getHeaders()}).pipe(t(this.handleError))}};a.\u0275fac=function(r){return new(r||a)(d(u))},a.\u0275prov=c({token:a,factory:a.\u0275fac,providedIn:"root"});let o=a;return o})();export{v as a};
