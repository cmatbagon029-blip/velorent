import{a as T}from"./chunk-TDFUMVDM.js";import{a as h}from"./chunk-NUHOWZQU.js";import{h as g,i as u,va as m}from"./chunk-2AVOPVJ6.js";import{g as c}from"./chunk-2K7NMRC4.js";var f=(()=>{let s=class s{constructor(t){this.router=t,this.MAX_ATTEMPTS=3,this.LOCKOUT_INTERVALS=[10,30,60],this.ATTEMPTS_KEY="login_attempts",this.LOCKOUT_UNTIL_KEY="lockout_until"}getAttempts(){let t=localStorage.getItem(this.ATTEMPTS_KEY);return t?parseInt(t):0}setAttempts(t){localStorage.setItem(this.ATTEMPTS_KEY,t.toString())}getLockoutUntil(){let t=localStorage.getItem(this.LOCKOUT_UNTIL_KEY);return t?parseInt(t):0}setLockoutUntil(t){localStorage.setItem(this.LOCKOUT_UNTIL_KEY,t.toString())}clearAttempts(){localStorage.removeItem(this.ATTEMPTS_KEY),localStorage.removeItem(this.LOCKOUT_UNTIL_KEY)}isLockedOut(){return this.getLockoutUntil()>Date.now()}getRemainingLockoutTime(){let t=this.getLockoutUntil(),o=Math.ceil((t-Date.now())/1e3);return o>0?o:0}login(t,o){return c(this,null,function*(){var r,i,l;if(console.log("=== LOGIN ATTEMPT ==="),console.log("Email:",t),console.log("Is Locked Out:",this.isLockedOut()),this.isLockedOut()){let e=this.getRemainingLockoutTime();return console.log("Account locked, remaining time:",e),{success:!1,message:`Account is locked. Please try again in ${e} seconds.`}}try{let e=((r=h)==null?void 0:r.apiUrl)||"https://velorent-backend.onrender.com/api";console.log("Sending login request to:",`${e}/auth/login`);let n=yield T.post(`${e}/auth/login`,{email:t,password:o});return console.log("Login response:",n.data),n.data.token?(console.log("Login successful, setting localStorage"),this.clearAttempts(),localStorage.setItem("token",n.data.token),localStorage.setItem("user",JSON.stringify(n.data.user)),localStorage.removeItem("logged_out"),console.log("Token stored in localStorage"),{success:!0,message:"Login successful"}):(console.log("Login failed - no token in response"),this.handleFailedAttempt(),{success:!1,message:n.data.message||"Login failed"})}catch(e){return console.error("Login error:",e),console.error("Error details:",{response:(i=e.response)==null?void 0:i.data,status:(l=e.response)==null?void 0:l.status,message:e.message}),this.handleFailedAttempt(),e.response?{success:!1,message:e.response.data.message||"Login failed"}:e.request?{success:!1,message:"No response from server. Please check if the server is running."}:{success:!1,message:"Error setting up the request: "+e.message}}})}handleFailedAttempt(){let t=this.getAttempts()+1;if(this.setAttempts(t),t>=this.MAX_ATTEMPTS){let o=Math.min(t-this.MAX_ATTEMPTS,this.LOCKOUT_INTERVALS.length-1),r=this.LOCKOUT_INTERVALS[o],i=Date.now()+r*1e3;this.setLockoutUntil(i)}}logout(){localStorage.removeItem("token"),localStorage.removeItem("user"),this.router.navigateByUrl("/dashboard",{replaceUrl:!0})}};s.\u0275fac=function(o){return new(o||s)(u(m))},s.\u0275prov=g({token:s,factory:s.\u0275fac,providedIn:"root"});let a=s;return a})();export{f as a};
