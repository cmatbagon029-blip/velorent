import{a as l}from"./chunk-FMDZ6S3R.js";import{a as h}from"./chunk-NUHOWZQU.js";import{aa as d,b as u,ba as p,h as i,i as a}from"./chunk-2AVOPVJ6.js";var y=(()=>{let s=class s{constructor(e){this.apiService=e,this.unreadCountSubject=new u(0),this.unreadCount$=this.unreadCountSubject.asObservable()}updateUnreadCount(){console.log("NotificationService: Updating unread count..."),this.apiService.getMyBookings().subscribe({next:e=>{console.log("NotificationService: Received bookings:",e);let t=0;e.forEach(r=>{console.log("Checking booking:",{id:r.id,company_message:r.company_message,notification_sent:r.notification_sent,hasMessage:!!r.company_message,isUnread:r.notification_sent!==1}),r.company_message&&r.notification_sent!==1&&(t++,console.log("Found unread message for booking:",r.id))}),console.log("NotificationService: Total unread count:",t),this.unreadCountSubject.next(t)},error:e=>{console.error("NotificationService: Error updating unread count:",e)}})}getUnreadCount(){return this.unreadCountSubject.value}};s.\u0275fac=function(t){return new(t||s)(a(l))},s.\u0275prov=i({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();var m=(()=>{let s=class s{constructor(e){var t;this.http=e,this.apiUrl=((t=h)==null?void 0:t.apiUrl)||"https://velorent-backend.onrender.com/api"}getHeaders(){let e=localStorage.getItem("token");return new d().set("Authorization",`Bearer ${e}`)}getCompanyPolicies(e){return this.http.get(`${this.apiUrl}/companies/${e}/policies`)}getMyRequests(){return this.http.get(`${this.apiUrl}/requests/my-requests`,{headers:this.getHeaders()})}getRequest(e){return this.http.get(`${this.apiUrl}/requests/${e}`,{headers:this.getHeaders()})}createRequest(e){return this.http.post(`${this.apiUrl}/requests`,e,{headers:this.getHeaders()})}computeFee(e,t,r){return this.http.post(`${this.apiUrl}/requests/compute-fee`,{booking_id:e,request_type:t,new_start_date:r},{headers:this.getHeaders()})}deleteRequest(e){return this.http.delete(`${this.apiUrl}/requests/${e}`,{headers:this.getHeaders()})}deleteMultipleRequests(e){return this.http.post(`${this.apiUrl}/requests/delete-multiple`,{requestIds:e},{headers:this.getHeaders()})}};s.\u0275fac=function(t){return new(t||s)(a(p))},s.\u0275prov=i({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();var I=(()=>{let s=class s{constructor(e){this.bookingRequestService=e,this.unreadCountSubject=new u(0),this.unreadCount$=this.unreadCountSubject.asObservable(),this.previousRequestStatuses=new Map,this.loadPreviousStatuses()}loadPreviousStatuses(){let e=localStorage.getItem("requestStatuses");if(e)try{let t=JSON.parse(e);this.previousRequestStatuses=new Map(t)}catch(t){console.error("Error loading previous request statuses:",t)}}savePreviousStatuses(){let e=Array.from(this.previousRequestStatuses.entries());localStorage.setItem("requestStatuses",JSON.stringify(e))}updateUnreadCount(){console.log("RequestNotificationService: Updating unread count..."),this.bookingRequestService.getMyRequests().subscribe({next:e=>{console.log("RequestNotificationService: Received requests:",e);let t=0;e.forEach(r=>{if(!r.id)return;let c=this.previousRequestStatuses.get(r.id),n=r.status;if(c&&c!==n&&(n==="approved"||n==="rejected")){let g=`request_seen_${r.id}_${n}`;localStorage.getItem(g)==="true"||(t++,console.log("Found unread request status change for request:",r.id))}this.previousRequestStatuses.set(r.id,n)}),this.savePreviousStatuses(),console.log("RequestNotificationService: Total unread count:",t),this.unreadCountSubject.next(t)},error:e=>{console.error("RequestNotificationService: Error updating unread count:",e)}})}markRequestAsSeen(e,t){let r=`request_seen_${e}_${t}`;localStorage.setItem(r,"true"),this.updateUnreadCount()}markAllAsSeen(){this.bookingRequestService.getMyRequests().subscribe({next:e=>{e.forEach(t=>{if(t.id&&(t.status==="approved"||t.status==="rejected")){let r=`request_seen_${t.id}_${t.status}`;localStorage.setItem(r,"true")}}),this.updateUnreadCount()}})}getUnreadCount(){return this.unreadCountSubject.value}};s.\u0275fac=function(t){return new(t||s)(a(m))},s.\u0275prov=i({token:s,factory:s.\u0275fac,providedIn:"root"});let o=s;return o})();export{y as a,m as b,I as c};
