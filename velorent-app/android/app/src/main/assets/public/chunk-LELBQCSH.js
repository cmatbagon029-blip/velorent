import{a as lt,c as st}from"./chunk-57YP3I6H.js";import{a as K}from"./chunk-FMDZ6S3R.js";import"./chunk-NUHOWZQU.js";import{B as et,C as it,L as ot,P as at,X as rt,Z as ct,a as Q,f as W,i as X,m as Z,p as tt,u as nt}from"./chunk-5FV2MGAH.js";import{$ as T,A as m,B as M,C as f,D as p,Eb as B,Gb as D,H as l,I as x,Ib as H,J as C,K as I,O as S,Ob as Y,Qb as G,Sb as J,W as w,X as N,cb as z,eb as R,fb as q,k,n as b,nb as U,o as P,qb as j,rb as $,s as c,t as _,tb as L,u,ub as V,va as E,vb as F,w as d,x as y,y as e,ya as A,z as o}from"./chunk-2AVOPVJ6.js";import"./chunk-6TEYLYMN.js";import"./chunk-QUJFQN2Y.js";import"./chunk-MQ34CZDB.js";import"./chunk-3HFMG4JC.js";import"./chunk-GNKKXBWB.js";import"./chunk-ALHFSM7F.js";import"./chunk-6EIW3MWH.js";import"./chunk-V2LICYYN.js";import"./chunk-J3KPDA35.js";import"./chunk-HQYYVS42.js";import"./chunk-E6DTWWEQ.js";import"./chunk-SYUL6SJY.js";import"./chunk-RFVCZTOC.js";import"./chunk-DI7UCLSP.js";import"./chunk-3IVKBF6N.js";import"./chunk-FXFZIWDD.js";import"./chunk-BGL2RXYC.js";import"./chunk-42C7ZIID.js";import"./chunk-C5RQ2IC2.js";import"./chunk-4FNGVWOR.js";import"./chunk-F7H4DQG2.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-EGZPES6R.js";import"./chunk-CKP3SGE2.js";import"./chunk-BGDP6BPN.js";import{g as O}from"./chunk-2K7NMRC4.js";function mt(a,s){if(a&1&&(e(0,"p",23),l(1),o()),a&2){let r=p();c(),I(" ",r.getUnreadCount()," unread notification",r.getUnreadCount()>1?"s":""," ")}}function gt(a,s){if(a&1){let r=M();e(0,"ion-button",24),f("click",function(){b(r);let i=p();return P(i.markAllAsRead())}),l(1," Mark All Read "),o()}}function dt(a,s){a&1&&(e(0,"div",25),m(1,"ion-spinner",26),e(2,"p"),l(3,"Loading notifications..."),o()())}function ft(a,s){a&1&&(e(0,"div",27),m(1,"ion-icon",28),e(2,"h2"),l(3,"No Notifications"),o(),e(4,"p"),l(5,"You're all caught up! No new notifications at the moment."),o()())}function pt(a,s){if(a&1&&(e(0,"span",42),m(1,"ion-icon",43),l(2),o()),a&2){let r=p().$implicit;c(2),C(" ",r.companyName," ")}}function ut(a,s){if(a&1){let r=M();e(0,"ion-item",31),f("click",function(){let i=b(r).$implicit,n=p(2);return P(n.markAsRead(i))}),e(1,"ion-avatar",32),m(2,"ion-icon",33),o(),e(3,"ion-label")(4,"h2",34),l(5),o(),e(6,"p",35),l(7),o(),e(8,"div",36)(9,"span",37),m(10,"ion-icon",38),l(11),o(),u(12,pt,3,1,"span",39),o()(),e(13,"ion-button",40),f("click",function(i){let n=b(r).$implicit;return p(2).deleteNotification(n),P(i.stopPropagation())}),m(14,"ion-icon",41),o()()}if(a&2){let r=s.$implicit,t=p(2);y("unread",!r.read),c(2),d("name",t.getNotificationIcon(r.type))("color",t.getNotificationColor(r.type)),c(3),x(r.title),c(2),x(r.message),c(4),C(" ",t.formatTimestamp(r.timestamp)," "),c(),d("ngIf",r.companyName)}}function _t(a,s){if(a&1&&(e(0,"ion-list",29),u(1,ut,15,8,"ion-item",30),o()),a&2){let r=p();c(),d("ngForOf",r.notifications)}}function Ct(a,s){if(a&1&&(e(0,"div",44),l(1),o()),a&2){let r=p();c(),C(" ",r.requestUnreadCount," ")}}function vt(a,s){if(a&1&&(e(0,"div",44),l(1),o()),a&2){let r=p();c(),C(" ",r.unreadCount," ")}}Q({home:et,"car-outline":X,"person-outline":at,"notifications-outline":ot,"chatbubble-outline":Z,"checkmark-circle-outline":tt,"information-circle-outline":it,"warning-outline":ct,"time-outline":rt,"business-outline":W,"close-outline":nt});var Tt=(()=>{let s=class s{constructor(t,i,n,g,v,h){this.router=t,this.alertCtrl=i,this.modalCtrl=n,this.apiService=g,this.notificationService=v,this.requestNotificationService=h,this.notifications=[],this.loading=!0,this.unreadCount=0,this.requestUnreadCount=0}ngOnInit(){this.loadNotifications(),this.notificationService.updateUnreadCount(),this.requestNotificationService.updateUnreadCount(),this.notificationService.unreadCount$.subscribe(t=>{this.unreadCount=t}),this.requestNotificationService.unreadCount$.subscribe(t=>{this.requestUnreadCount=t})}loadNotifications(){this.loading=!0,this.apiService.getMyBookings().subscribe({next:t=>{this.notifications=[],t.forEach(i=>{if(i.company_message){let n=i.company_message.trim();n=n.replace(/^h\s*\[Admin Remarks\]:\s*ll\s*/i,""),n=n.replace(/\[Admin Remarks\]:\s*/gi,""),n&&n.length>0&&this.notifications.push({id:i.id,title:`Message from ${i.company_name||"Company"}`,message:n,type:"booking",timestamp:new Date(i.message_sent_at||i.booking_date),read:i.notification_sent===1,companyName:i.company_name,bookingId:i.id.toString()})}}),this.notifications.sort((i,n)=>n.timestamp.getTime()-i.timestamp.getTime()),this.loading=!1,console.log("Loaded notifications:",this.notifications)},error:t=>{console.error("Error loading notifications:",t),this.loading=!1}})}markAsRead(t){t.read=!0,this.apiService.markNotificationAsRead(t.id).subscribe({next:()=>{console.log("Notification marked as read"),this.notificationService.updateUnreadCount()},error:i=>{console.error("Error marking notification as read:",i)}})}markAllAsRead(){this.notifications.forEach(t=>{t.read=!0,this.apiService.markNotificationAsRead(t.id).subscribe({next:()=>{console.log("All notifications marked as read")},error:i=>{console.error("Error marking notifications as read:",i)}})}),this.notificationService.updateUnreadCount()}deleteNotification(t){this.notifications=this.notifications.filter(i=>i.id!==t.id)}getNotificationIcon(t){switch(t){case"success":return"checkmark-circle-outline";case"warning":return"warning-outline";case"booking":return"car-outline";default:return"information-circle-outline"}}getNotificationColor(t){switch(t){case"success":return"success";case"warning":return"warning";case"booking":return"primary";default:return"medium"}}formatTimestamp(t){let n=new Date().getTime()-t.getTime(),g=Math.floor(n/(1e3*60)),v=Math.floor(n/(1e3*60*60)),h=Math.floor(n/(1e3*60*60*24));return g<60?`${g}m ago`:v<24?`${v}h ago`:`${h}d ago`}getUnreadCount(){return this.notifications.filter(t=>!t.read).length}openChat(){console.log("Navigating to Chat..."),this.router.navigate(["/chat"])}navigateToHome(){this.router.navigate(["/dashboard"])}navigateToMyRentals(){localStorage.getItem("user")?this.router.navigate(["/my-rentals"]):this.showLoginAlert()}navigateToRequests(){localStorage.getItem("user")?this.router.navigate(["/booking-requests"]):this.showLoginAlert()}navigateToNotifications(){console.log("Already on Notifications page")}navigateToProfile(){this.router.navigate(["/profile"])}showLoginAlert(){return O(this,null,function*(){yield(yield this.alertCtrl.create({header:"Login Required",message:"Please log in to view your rentals.",buttons:[{text:"Cancel",role:"cancel"},{text:"Login",handler:()=>{this.router.navigate(["/login"])}}]})).present()})}};s.\u0275fac=function(i){return new(i||s)(_(E),_(Y),_(G),_(K),_(lt),_(st))},s.\u0275cmp=k({type:s,selectors:[["app-notifications"]],standalone:!0,features:[S],decls:41,vars:8,consts:[["slot","end"],[1,"chat-button",3,"click"],["name","chatbubble-outline",1,"chat-icon"],[1,"ion-padding"],[1,"notifications-header"],[1,"header-info"],["class","unread-count",4,"ngIf"],["fill","outline","size","small",3,"click",4,"ngIf"],["class","loading-container",4,"ngIf"],["class","empty-container",4,"ngIf"],["class","notifications-list",4,"ngIf"],[1,"bottom-nav"],[1,"nav-container"],[1,"nav-button",3,"click"],["name","home",1,"nav-icon"],[1,"nav-label"],["name","car-outline",1,"nav-icon"],[1,"notification-wrapper"],["name","document-text-outline",1,"nav-icon"],["class","notification-badge",4,"ngIf"],[1,"nav-button","active",3,"click"],["name","notifications-outline",1,"nav-icon"],["name","person-outline",1,"nav-icon"],[1,"unread-count"],["fill","outline","size","small",3,"click"],[1,"loading-container"],["name","crescent"],[1,"empty-container"],["name","notifications-outline"],[1,"notifications-list"],["class","notification-item",3,"unread","click",4,"ngFor","ngForOf"],[1,"notification-item",3,"click"],["slot","start",1,"notification-avatar"],[3,"name","color"],[1,"notification-title"],[1,"notification-message"],[1,"notification-meta"],[1,"timestamp"],["name","time-outline"],["class","company",4,"ngIf"],["slot","end","fill","clear","size","small","color","medium",3,"click"],["name","close-outline"],[1,"company"],["name","business-outline"],[1,"notification-badge"]],template:function(i,n){i&1&&(e(0,"ion-header")(1,"ion-toolbar")(2,"ion-title"),l(3,"Notifications"),o(),e(4,"ion-buttons",0)(5,"ion-button",1),f("click",function(){return n.openChat()}),m(6,"ion-icon",2),o()()()(),e(7,"ion-content",3)(8,"div",4)(9,"div",5),u(10,mt,2,2,"p",6),o(),u(11,gt,2,0,"ion-button",7),o(),u(12,dt,4,0,"div",8)(13,ft,6,0,"div",9)(14,_t,2,1,"ion-list",10),o(),e(15,"div",11)(16,"div",12)(17,"button",13),f("click",function(){return n.navigateToHome()}),m(18,"ion-icon",14),e(19,"span",15),l(20,"Home"),o()(),e(21,"button",13),f("click",function(){return n.navigateToMyRentals()}),m(22,"ion-icon",16),e(23,"span",15),l(24,"My Rentals"),o()(),e(25,"button",13),f("click",function(){return n.navigateToRequests()}),e(26,"div",17),m(27,"ion-icon",18),u(28,Ct,2,1,"div",19),o(),e(29,"span",15),l(30),o()(),e(31,"button",20),f("click",function(){return n.navigateToNotifications()}),e(32,"div",17),m(33,"ion-icon",21),u(34,vt,2,1,"div",19),o(),e(35,"span",15),l(36,"Notifications"),o()(),e(37,"button",13),f("click",function(){return n.navigateToProfile()}),m(38,"ion-icon",22),e(39,"span",15),l(40,"Profile"),o()()()()),i&2&&(c(10),d("ngIf",n.getUnreadCount()>0),c(),d("ngIf",n.getUnreadCount()>0),c(),d("ngIf",n.loading),c(),d("ngIf",!n.loading&&n.notifications.length===0),c(),d("ngIf",!n.loading&&n.notifications.length>0),c(14),d("ngIf",n.requestUnreadCount>0),c(2),C("Requests",n.requestUnreadCount>0?" ("+n.requestUnreadCount+")":"",""),c(4),d("ngIf",n.unreadCount>0))},dependencies:[J,z,R,q,U,j,$,L,V,F,B,D,H,T,w,N,A],styles:["ion-header[_ngcontent-%COMP%], ion-toolbar[_ngcontent-%COMP%]{--background: #0A0A0A !important;background:#0a0a0a!important}ion-title[_ngcontent-%COMP%]{color:#d4af37!important;font-weight:600}.chat-button[_ngcontent-%COMP%]{--color: #D4AF37 !important;--background: rgba(250, 204, 21, .1) !important;--border-radius: 50% !important;--padding-start: 12px !important;--padding-end: 12px !important;--padding-top: 12px !important;--padding-bottom: 12px !important;margin-right:8px!important;transition:all .3s ease!important}.chat-button[_ngcontent-%COMP%]:hover{--background: rgba(250, 204, 21, .2) !important;transform:scale(1.1)!important}.chat-button[_ngcontent-%COMP%]   .chat-icon[_ngcontent-%COMP%]{font-size:1.5rem!important;color:#d4af37!important}ion-content[_ngcontent-%COMP%]{--background: #0A0A0A;background:#0a0a0a!important;padding-bottom:120px}.notifications-header[_ngcontent-%COMP%]{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;padding:16px 0}.notifications-header[_ngcontent-%COMP%]   .header-info[_ngcontent-%COMP%]   .unread-count[_ngcontent-%COMP%]{color:#ff6b6b;margin:0;font-size:.9rem;font-weight:500}.loading-container[_ngcontent-%COMP%], .empty-container[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:60px 20px;text-align:center}.loading-container[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .empty-container[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:4rem;color:#666;margin-bottom:16px}.loading-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%], .empty-container[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{color:#fff;margin:0 0 8px;font-size:1.5rem}.loading-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%], .empty-container[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:#999;margin:0;font-size:1rem}.notifications-list[_ngcontent-%COMP%]{background:transparent;margin:0 0 40px}.notification-item[_ngcontent-%COMP%]{--background: #1B1B1B;--border-color: rgba(255, 255, 255, .1);margin-bottom:12px;border-radius:12px;border:1px solid rgba(255,255,255,.1);transition:all .3s ease}.notification-item.unread[_ngcontent-%COMP%]{--background: #333333;border-color:#d4af37;box-shadow:0 2px 8px #facc151a}.notification-item[_ngcontent-%COMP%]:hover{--background: #333333;transform:translateY(-2px);box-shadow:0 4px 12px #0000004d}.notification-item[_ngcontent-%COMP%]   .notification-avatar[_ngcontent-%COMP%]{width:40px;height:40px;background:#ffffff1a;border-radius:50%;display:flex;align-items:center;justify-content:center}.notification-item[_ngcontent-%COMP%]   .notification-avatar[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.2rem}.notification-item[_ngcontent-%COMP%]   .notification-title[_ngcontent-%COMP%]{color:#ededed;font-size:1rem;font-weight:600;margin:0 0 4px}.notification-item[_ngcontent-%COMP%]   .notification-message[_ngcontent-%COMP%]{color:#b3b3b3;font-size:.9rem;margin:0 0 8px;line-height:1.4}.notification-item[_ngcontent-%COMP%]   .notification-meta[_ngcontent-%COMP%]{display:flex;gap:16px;align-items:center}.notification-item[_ngcontent-%COMP%]   .notification-meta[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%], .notification-item[_ngcontent-%COMP%]   .notification-meta[_ngcontent-%COMP%]   .company[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px;color:#b3b3b3;font-size:.8rem}.notification-item[_ngcontent-%COMP%]   .notification-meta[_ngcontent-%COMP%]   .timestamp[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%], .notification-item[_ngcontent-%COMP%]   .notification-meta[_ngcontent-%COMP%]   .company[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:.9rem}.bottom-nav[_ngcontent-%COMP%]{position:fixed;bottom:0;left:0;right:0;z-index:1000;background:linear-gradient(180deg,#0a0a0a,#0f0f0f);border-top:1px solid rgba(255,255,255,.05);box-shadow:0 -4px 20px #facc1533;-webkit-backdrop-filter:blur(20px);backdrop-filter:blur(20px)}.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]{display:flex;justify-content:space-around;align-items:center;height:80px;padding:0 16px}.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]   .nav-button[_ngcontent-%COMP%]{display:flex;flex-direction:column;align-items:center;justify-content:center;background:transparent;border:none;padding:8px 12px;border-radius:12px;cursor:pointer;color:#b3b3b3;min-width:60px}.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]   .nav-button[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]{font-size:1.8rem;margin-bottom:4px;transition:all .3s ease;color:#ededed!important;display:block}.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]   .nav-button[_ngcontent-%COMP%]   .nav-label[_ngcontent-%COMP%]{font-size:.75rem;font-weight:500;transition:all .3s ease;color:inherit}.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]   .nav-button.active[_ngcontent-%COMP%]{color:#d4af37;background:#facc1526}.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]   .nav-button.active[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]{transform:scale(1.1);color:#d4af37}.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]   .nav-button.active[_ngcontent-%COMP%]   .nav-label[_ngcontent-%COMP%]{font-weight:600;color:#d4af37}.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]   .nav-button[_ngcontent-%COMP%]:hover{background:#facc151a;color:#d4af37}.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]   .nav-button[_ngcontent-%COMP%]:hover   .nav-icon[_ngcontent-%COMP%], .bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]   .nav-button[_ngcontent-%COMP%]:hover   .nav-label[_ngcontent-%COMP%]{color:#d4af37}.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]   .nav-button[_ngcontent-%COMP%]:active{transform:scale(.95)}.notification-wrapper[_ngcontent-%COMP%]{position:relative;display:inline-block}.notification-wrapper[_ngcontent-%COMP%]   .notification-badge[_ngcontent-%COMP%]{position:absolute;top:-4px;right:-4px;background:#ef4444;color:#fff;border-radius:50%;width:20px;height:20px;display:flex;align-items:center;justify-content:center;font-size:.7rem;font-weight:700;border:2px solid var(--background-main);z-index:10;box-shadow:0 2px 8px #ef444466}@media (max-width: 768px){.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]{height:70px;padding:0 8px}.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]   .nav-button[_ngcontent-%COMP%]{min-width:50px;padding:6px 8px}.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]   .nav-button[_ngcontent-%COMP%]   .nav-icon[_ngcontent-%COMP%]{font-size:1.6rem}.bottom-nav[_ngcontent-%COMP%]   .nav-container[_ngcontent-%COMP%]   .nav-button[_ngcontent-%COMP%]   .nav-label[_ngcontent-%COMP%]{font-size:.7rem}ion-content[_ngcontent-%COMP%]{padding-bottom:110px}.notifications-header[_ngcontent-%COMP%]{flex-direction:column;align-items:flex-start;gap:12px}}"]});let a=s;return a})();export{Tt as NotificationsPage};
