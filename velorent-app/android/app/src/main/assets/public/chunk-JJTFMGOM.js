import{a as B}from"./chunk-FMDZ6S3R.js";import"./chunk-NUHOWZQU.js";import{$ as C,A as g,C as u,D as I,Eb as R,H as h,J as y,O as P,Rb as O,Sb as E,Va as x,X as b,eb as _,k as p,nb as S,rb as M,s as m,t as c,u as v,ua as w,va as T,w as k,y as a,z as l}from"./chunk-2AVOPVJ6.js";import"./chunk-6TEYLYMN.js";import"./chunk-QUJFQN2Y.js";import"./chunk-MQ34CZDB.js";import"./chunk-3HFMG4JC.js";import"./chunk-GNKKXBWB.js";import"./chunk-ALHFSM7F.js";import"./chunk-6EIW3MWH.js";import"./chunk-V2LICYYN.js";import"./chunk-J3KPDA35.js";import"./chunk-HQYYVS42.js";import"./chunk-E6DTWWEQ.js";import"./chunk-SYUL6SJY.js";import"./chunk-RFVCZTOC.js";import"./chunk-DI7UCLSP.js";import"./chunk-3IVKBF6N.js";import"./chunk-FXFZIWDD.js";import"./chunk-BGL2RXYC.js";import"./chunk-42C7ZIID.js";import"./chunk-C5RQ2IC2.js";import"./chunk-4FNGVWOR.js";import"./chunk-F7H4DQG2.js";import"./chunk-LBMIQEU6.js";import"./chunk-WI5MSH4N.js";import"./chunk-EGZPES6R.js";import"./chunk-CKP3SGE2.js";import"./chunk-BGDP6BPN.js";import{g as f}from"./chunk-2K7NMRC4.js";function F(s,o){if(s&1&&(a(0,"p",9),h(1),l()),s&2){let j=I();m(),y("Booking ID: ",j.bookingId,"")}}var W=(()=>{let o=class o{constructor(e,t,i,r,n){this.route=e,this.router=t,this.apiService=i,this.toastController=r,this.navCtrl=n,this.bookingId=null,this.checkInterval=null,this.paymentConfirmed=!1}ngOnInit(){this.route.queryParams.subscribe(e=>{this.bookingId=e.booking_id?parseInt(e.booking_id):sessionStorage.getItem("pendingPaymentBookingId")?parseInt(sessionStorage.getItem("pendingPaymentBookingId")):null,sessionStorage.getItem("pendingPaymentBookingId")&&sessionStorage.removeItem("pendingPaymentBookingId"),this.bookingId?this.checkPaymentStatus(this.bookingId):(this.showToast("Booking ID not found","danger"),setTimeout(()=>{this.navCtrl.navigateRoot("/dashboard")},2e3))})}checkPaymentStatus(e){if(this.paymentConfirmed)return;let t=0,i=30,r=()=>{if(this.paymentConfirmed){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null);return}t++,console.log(`Checking payment status (attempt ${t}/${i}) for booking ${e}`),this.apiService.getPaymentStatus(e).subscribe({next:n=>{console.log("Payment status response:",n),n.status==="paid"?this.paymentConfirmed||(this.paymentConfirmed=!0,this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.showToast("Payment confirmed! Your booking has been submitted successfully.","success"),setTimeout(()=>{this.navCtrl.navigateRoot("/my-rentals")},2e3)):n.status==="failed"?(this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.showToast("Payment failed. Please try again.","danger"),setTimeout(()=>{this.navCtrl.navigateRoot("/rent-vehicle")},3e3)):n.status==="pending"?(console.log("Payment still pending, will check again..."),t>=i&&(this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.showToast("Payment verification is taking longer than expected. Please check your booking status in My Rentals.","warning"),setTimeout(()=>{this.navCtrl.navigateRoot("/my-rentals")},3e3))):(console.warn("Unknown payment status:",n.status),t>=i&&(this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.showToast("Payment status unclear. Please check your booking in My Rentals.","warning"),setTimeout(()=>{this.navCtrl.navigateRoot("/my-rentals")},3e3)))},error:n=>{var d;if(console.error("Error checking payment status:",n),console.error("Error details:",JSON.stringify(n,null,2)),n.status===404&&t<i&&!this.paymentConfirmed){console.log("Payment not found yet, will continue checking...");return}if(t>=i&&!this.paymentConfirmed){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null);let D=((d=n.error)==null?void 0:d.error)||n.message||"Unable to verify payment status";this.showToast(`${D}. Please check your booking in My Rentals.`,"warning"),setTimeout(()=>{this.navCtrl.navigateRoot("/my-rentals")},3e3)}}})};r(),this.checkInterval=setInterval(r,6e3)}forceCheckStatus(){this.bookingId&&!this.paymentConfirmed&&(console.log("Force checking payment status..."),this.apiService.getPaymentStatus(this.bookingId).subscribe({next:e=>{console.log("Forced check - Payment status:",e),e.status==="paid"?(this.paymentConfirmed=!0,this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.showToast("Payment confirmed!","success"),setTimeout(()=>{this.navCtrl.navigateRoot("/my-rentals")},1500)):e.status==="failed"?(this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null),this.showToast("Payment failed. Please try again.","danger")):this.showToast("Payment is still being processed. Please wait...","warning")},error:e=>{console.error("Error in force check:",e),this.showToast("Unable to check payment status. Please try again later.","warning")}}))}goToMyRentals(){this.checkInterval&&clearInterval(this.checkInterval),this.navCtrl.navigateRoot("/my-rentals")}ngOnDestroy(){this.checkInterval&&(clearInterval(this.checkInterval),this.checkInterval=null)}showToast(e,t){return f(this,null,function*(){(yield this.toastController.create({message:e,duration:3e3,color:t,position:"top"})).present()})}};o.\u0275fac=function(t){return new(t||o)(c(w),c(T),c(B),c(O),c(x))},o.\u0275cmp=p({type:o,selectors:[["app-payment-success"]],standalone:!0,features:[P],decls:15,vars:1,consts:[[1,"ion-padding"],[1,"payment-container"],[1,"payment-content"],["name","checkmark-circle-outline",1,"success-icon"],["class","booking-info",4,"ngIf"],["name","crescent"],[1,"button-group"],["expand","block",1,"btn-primary-modern",3,"click"],["expand","block",1,"btn-secondary-modern",3,"click"],[1,"booking-info"]],template:function(t,i){t&1&&(a(0,"ion-content",0)(1,"div",1)(2,"div",2),g(3,"ion-icon",3),a(4,"h1"),h(5,"Payment Processing"),l(),a(6,"p"),h(7,"We're verifying your payment. Please wait..."),l(),v(8,F,2,1,"p",4),g(9,"ion-spinner",5),a(10,"div",6)(11,"ion-button",7),u("click",function(){return i.forceCheckStatus()}),h(12," Refresh Status "),l(),a(13,"ion-button",8),u("click",function(){return i.goToMyRentals()}),h(14," Skip to My Rentals "),l()()()()()),t&2&&(m(8),k("ngIf",i.bookingId))},dependencies:[E,_,S,M,R,C,b],styles:[".payment-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;min-height:100vh;background:linear-gradient(135deg,#0f0f23,#1a1a2e,#16213e,#0f3460)}.payment-content[_ngcontent-%COMP%]{text-align:center;color:#fff;padding:2rem;max-width:400px}.success-icon[_ngcontent-%COMP%]{font-size:80px;color:#4caf50;margin-bottom:1rem}h1[_ngcontent-%COMP%]{color:#d4af37;margin-bottom:1rem}p[_ngcontent-%COMP%]{color:#ccc;margin-bottom:2rem}ion-spinner[_ngcontent-%COMP%]{--color: #D4AF37}.booking-info[_ngcontent-%COMP%]{font-size:.9rem;color:#999;margin-top:.5rem}.button-group[_ngcontent-%COMP%]{margin-top:2rem;display:flex;flex-direction:column;gap:1rem;width:100%;max-width:400px;margin-left:auto;margin-right:auto}"]});let s=o;return s})();export{W as PaymentSuccessPage};
